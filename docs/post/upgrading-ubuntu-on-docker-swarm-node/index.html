<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Upgrading Ubuntu on Docker Swarm Node - Wes Shaddix | Blog</title>
  <link rel="alternate" hreflang="en" href="http://www.wesshaddix.com/" />

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Wes Shaddix" /><meta name="description" content="How to upgrade the OS of docker swarm nodes from Ubuntu 17.10 to Ubuntu 18.04" />

  <meta name="keywords" content="Wes, Wes Shaddix" />






<meta name="generator" content="Hugo 0.40.3" />


<link rel="canonical" href="http://www.wesshaddix.com/post/upgrading-ubuntu-on-docker-swarm-node/" />



<link rel="icon" href="/favicon.ico" />










<link href="/dist/jane.min.css?v=2.7.0" rel="stylesheet">



<link rel="stylesheet" href="/css/custom.css">


<meta property="og:title" content="Upgrading Ubuntu on Docker Swarm Node" />
<meta property="og:description" content="How to upgrade the OS of docker swarm nodes from Ubuntu 17.10 to Ubuntu 18.04" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.wesshaddix.com/post/upgrading-ubuntu-on-docker-swarm-node/" />



<meta property="article:published_time" content="2018-05-21T09:53:37-04:00"/>

<meta property="article:modified_time" content="2018-05-21T09:53:37-04:00"/>











<meta itemprop="name" content="Upgrading Ubuntu on Docker Swarm Node">
<meta itemprop="description" content="How to upgrade the OS of docker swarm nodes from Ubuntu 17.10 to Ubuntu 18.04">


<meta itemprop="datePublished" content="2018-05-21T09:53:37-04:00" />
<meta itemprop="dateModified" content="2018-05-21T09:53:37-04:00" />
<meta itemprop="wordCount" content="326">



<meta itemprop="keywords" content="docker,ubuntu,docker-swarm," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Upgrading Ubuntu on Docker Swarm Node"/>
<meta name="twitter:description" content="How to upgrade the OS of docker swarm nodes from Ubuntu 17.10 to Ubuntu 18.04"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-587905-4', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Wes&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        <a href="/">
          Home
        </a>
      </li><li class="mobile-menu-item">
        <a href="/post/">
          Archives
        </a>
      </li><li class="mobile-menu-item">
        <a href="/tags/">
          Tags
        </a>
      </li><li class="mobile-menu-item">
        <a href="/categories/">
          Categories
        </a>
      </li><li class="mobile-menu-item">
        <a href="https://github.com/wshaddix">
          My GitHub
        </a>
      </li>
  </ul>
</nav>

  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  
  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Wes's Blog
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://www.wesshaddix.com/">Home</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://www.wesshaddix.com/post/">Archives</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://www.wesshaddix.com/tags/">Tags</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://www.wesshaddix.com/categories/">Categories</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/wshaddix" rel="noopener" target="_blank">
              My GitHub
            <i class="iconfont icon-new-window"></i>
            </a>
          

        

      </li>
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Upgrading Ubuntu on Docker Swarm Node</h1>
      
      <div class="post-meta">
        <span class="post-time"> 2018-05-21 </span>
        
        <span class="more-meta"> 326 words </span>
        <span class="more-meta"> 2 min read </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li><a href="#scenario">Scenario</a>
<ul>
<li><a href="#step-1-drain-the-node">Step 1: Drain the Node</a></li>
<li><a href="#step-2-perform-the-os-upgrade">Step 2: Perform the OS upgrade</a></li>
<li><a href="#step-3-add-the-new-docker-repository">Step 3: Add the new Docker Repository</a></li>
<li><a href="#step-4-activate-the-node">Step 4: Activate the Node</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>In this post I&rsquo;m going to document the steps needed to upgrade the OS of docker swarm nodes from Ubuntu 17.10 to Ubuntu 18.04
</p>

<h1 id="scenario">Scenario</h1>

<p>From time to time you&rsquo;ll need to update the OS of the docker swarm nodes. In my case I&rsquo;m upgrading from Ubuntu 17.10 to Ubuntu 18.04. You have to be cautious of two things when your host is in a docker swarm node. First you have to drain the node that is being updated so that no services are running on the node (and thus disappear) and second you have to make sure you never lose quorum on the swarm cluster by removing a manager node. <strong>To maintain quorum, a majority of managers must be available.</strong></p>

<h2 id="step-1-drain-the-node">Step 1: Drain the Node</h2>

<p>The next step is to drain the node so that the services currently running on that node are moved to other nodes in the swarm.</p>

<p><code>docker node update --availability drain &lt;node name&gt;</code></p>

<p>You can verify the status by running</p>

<p><code>docker node ls</code></p>

<p>and you should see that the <code>AVAILABILITY</code> of the node is <code>Drain</code></p>

<p>You can verify that no containers are running on the node by running</p>

<p><code>docker container ps</code></p>

<h2 id="step-2-perform-the-os-upgrade">Step 2: Perform the OS upgrade</h2>

<p>From the drained node perform the OS upgrade by running</p>

<p><code>sudo do-release-upgrade</code></p>

<p>Follow the prompts and answer the questions. Eventually you&rsquo;ll be prompted to restart the computer.</p>

<h2 id="step-3-add-the-new-docker-repository">Step 3: Add the new Docker Repository</h2>

<p>Now that you have a new Ubuntu version you need to update the docker repository so that you can pull in the latest updates for your new version of Ubuntu.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">sudo add-apt-repository <span class="se">\
</span><span class="se"></span>   <span class="s2">&#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu \
</span><span class="s2">   </span><span class="k">$(</span>lsb_release -cs<span class="k">)</span><span class="s2"> \
</span><span class="s2">   stable&#34;</span></code></pre></td></tr></table>
</div>
</div>
<p>followed by</p>

<p><code>sudo apt-get update</code></p>

<h2 id="step-4-activate-the-node">Step 4: Activate the Node</h2>

<p>Set the node back to active in the swarm cluster by running the following command on a manager node</p>

<p><code>docker node update --availability Active &lt;node name&gt;</code></p>

<p>You can verify the status by running</p>

<p><code>docker node ls</code></p>
    </div>

    
    

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/docker/">docker</a>
          
          <a href="/tags/ubuntu/">ubuntu</a>
          
          <a href="/tags/docker-swarm/">docker-swarm</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/holding-back-package-updates-in-ubuntu/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Holding Back Package Updates in Ubuntu</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/docker-recipies/">
            <span class="next-text nav-default">Docker Recipies</span>
            <span class="prev-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
    

  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
      Show Disqus Comments
    </div>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
    function load_disqus() {
        
        
        if (window.location.hostname === 'localhost') return;

        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        var disqus_shortname = 'wesshaddix';
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

        $('#load_disqus').remove();
    };
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    

  

  
  </article>
        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:wes.shaddix@outlook.com" rel="me noopener" class="iconfont icon-email"
        title="email" target="_blank">
      </a>
      <a href="https://twitter.com/wshaddix" rel="me noopener" class="iconfont icon-twitter"
        title="twitter" target="_blank">
      </a>
      <a href="https://github.com/wshaddix" rel="me noopener" class="iconfont icon-github"
        title="github" target="_blank">
      </a>
  <a href="http://www.wesshaddix.com/index.xml" rel="noopener" type="application/rss+xml" class="iconfont icon-rss"
    title="rss" target="_blank">
  </a>
</div>

<div class="copyright">
  <span class="copyright-year">
    &copy;
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span><span class="author">Wes Shaddix</span></span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
<script type="text/javascript" src="/dist/jane.min.js?v=2.7.0"></script>





  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  





</body>
</html>
