<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Logging and Monitoring on a Docker Swarm Cluster - Wes Shaddix | Blog</title>
  <link rel="alternate" hreflang="en" href="http://www.wesshaddix.com/" />

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Wes Shaddix" />
  <meta name="description" content="How to setup data analytics, metrics and events collection and logging on a docker swarm cluster using sematext SPM and Logsene.

" />

  <meta name="keywords" content="Wes, Wes Shaddix" />






<meta name="generator" content="Hugo 0.40.3" />


<link rel="canonical" href="http://www.wesshaddix.com/post/logging-and-monitoring-on-a-docker-swarm-cluster/" />



<link rel="icon" href="/favicon.ico" />










<link href="/dist/jane.min.css?v=2.7.0" rel="stylesheet">



<link rel="stylesheet" href="/css/custom.css">


<meta property="og:title" content="Logging and Monitoring on a Docker Swarm Cluster" />
<meta property="og:description" content="How to setup data analytics, metrics and events collection and logging on a docker swarm cluster using sematext SPM and Logsene.

" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.wesshaddix.com/post/logging-and-monitoring-on-a-docker-swarm-cluster/" />



<meta property="article:published_time" content="2017-12-12T19:11:04-05:00"/>

<meta property="article:modified_time" content="2017-12-12T19:11:04-05:00"/>











<meta itemprop="name" content="Logging and Monitoring on a Docker Swarm Cluster">
<meta itemprop="description" content="How to setup data analytics, metrics and events collection and logging on a docker swarm cluster using sematext SPM and Logsene.

">


<meta itemprop="datePublished" content="2017-12-12T19:11:04-05:00" />
<meta itemprop="dateModified" content="2017-12-12T19:11:04-05:00" />
<meta itemprop="wordCount" content="383">



<meta itemprop="keywords" content="docker,docker-swarm,logging,metrics,sematext," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Logging and Monitoring on a Docker Swarm Cluster"/>
<meta name="twitter:description" content="How to setup data analytics, metrics and events collection and logging on a docker swarm cluster using sematext SPM and Logsene.

"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-587905-4', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Wes&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        <a href="/">
          Home
        </a>
      </li><li class="mobile-menu-item">
        <a href="/post/">
          Archives
        </a>
      </li><li class="mobile-menu-item">
        <a href="/tags/">
          Tags
        </a>
      </li><li class="mobile-menu-item">
        <a href="/categories/">
          Categories
        </a>
      </li><li class="mobile-menu-item">
        <a href="https://github.com/wshaddix">
          My GitHub
        </a>
      </li>
  </ul>
</nav>

  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  
  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Wes's Blog
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://www.wesshaddix.com/">Home</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://www.wesshaddix.com/post/">Archives</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://www.wesshaddix.com/tags/">Tags</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://www.wesshaddix.com/categories/">Categories</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/wshaddix" rel="noopener" target="_blank">
              My GitHub
            <i class="iconfont icon-new-window"></i>
            </a>
          

        

      </li>
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Logging and Monitoring on a Docker Swarm Cluster</h1>
      
      <div class="post-meta">
        <span class="post-time"> 2017-12-12 </span>
        
        <span class="more-meta"> 383 words </span>
        <span class="more-meta"> 2 min read </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li><a href="#overview">Overview</a>
<ul>
<li><a href="#create-your-sematext-account">Create your Sematext account</a></li>
<li><a href="#create-your-application">Create your application</a></li>
<li><a href="#configure-your-swarm-stack">Configure your swarm stack</a></li>
<li><a href="#setting-up-your-swarm-stack">Setting up your swarm stack</a>
<ul>
<li><a href="#ssh-into-your-swarm-manager-node">ssh into your swarm manager node</a></li>
<li><a href="#checkout-your-swarm-configuration-repo">Checkout your swarm configuration repo</a></li>
<li><a href="#deploy-your-swarm-stack">Deploy your swarm stack</a></li>
</ul></li>
<li><a href="#view-metrics-and-logs">View metrics and logs</a>
<ul>
<li><a href="#metrics">Metrics</a></li>
<li><a href="#logs">Logs</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>How to setup data analytics, metrics and events collection and logging on a docker swarm cluster using sematext SPM and Logsene.</p>

<p></p>

<h1 id="overview">Overview</h1>

<p>After <a href="http://www.wesshaddix.com/post/three-node-docker-swarm-cluster/">setting up a docker swarm cluster</a> and then being able to <a href="http://www.wesshaddix.com/post/visualizing-a-docker-swarm-cluster/">visualize what is running on the cluster</a> the next concept I wanted to implement was logging and metrics. I&rsquo;ve used several 3rd party logging and metrics services in the past but while reading <a href="https://www.amazon.com/Docker-Management-Design-Patterns-Services/dp/148422972X">Docker Management Design Patterns</a> I found a great all-in-one solution called <a href="https://sematext.com/">Sematext</a>.</p>

<p>They have a service that includes logging, metrics, events and alerts and they have a docker agent that gets everything going pretty quickly. You simply sign up for an account, create your application and use your application tokens to configure your docker agent within your swarm cluster. The agent runs on each node of the swarm cluster.</p>

<h2 id="create-your-sematext-account">Create your Sematext account</h2>

<p>The first step is to head over to <a href="https://apps.sematext.com/ui/registration">Sematext&rsquo;s registration page</a> and create yourself an account.</p>

<h2 id="create-your-application">Create your application</h2>

<p>Next head over to the <a href="https://apps.sematext.com/ui/integrations/create/docker">docker integration page</a> and create a new application for the cluster. Be sure to also include logging support (checked by default)</p>

<p><img src="/img/sematext-new-app.png" alt="screenshot" /></p>

<h2 id="configure-your-swarm-stack">Configure your swarm stack</h2>

<p>To make things easy to configure and deploy I created a <a href="https://github.com/wshaddix/docker-swarm-config">GitHub repo</a> that stores my stack definition. So far I&rsquo;ve included the vizualizer and the sematext docker agent as one stack as shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml">version<span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.4&#39;</span><span class="w">
</span><span class="w">
</span><span class="w"></span>services<span class="p">:</span><span class="w">
</span><span class="w">  </span>vizualizer<span class="p">:</span><span class="w">
</span><span class="w">    </span>image<span class="p">:</span><span class="w"> </span>dockersamples/visualizer<span class="w">
</span><span class="w">    </span>volumes<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>type<span class="p">:</span><span class="w"> </span>bind<span class="w">
</span><span class="w">        </span>source<span class="p">:</span><span class="w"> </span>/var/run/docker.sock<span class="w">
</span><span class="w">        </span>target<span class="p">:</span><span class="w"> </span>/var/run/docker.sock<span class="w">
</span><span class="w">    </span>ports<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;8080:8080/tcp&#34;</span><span class="w">
</span><span class="w">    </span>deploy<span class="p">:</span><span class="w">
</span><span class="w">      </span>replicas<span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">      </span>placement<span class="p">:</span><span class="w">
</span><span class="w">        </span>constraints<span class="p">:</span><span class="w">
</span><span class="w">          </span>-<span class="w"> </span>node.role<span class="w"> </span>==<span class="w"> </span>manager<span class="w">
</span><span class="w">  </span>sematext<span class="p">:</span><span class="w">
</span><span class="w">    </span>image<span class="p">:</span><span class="w"> </span>sematext/sematext-agent-docker<span class="w">
</span><span class="w">    </span>volumes<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>type<span class="p">:</span><span class="w"> </span>bind<span class="w">
</span><span class="w">        </span>source<span class="p">:</span><span class="w"> </span>/var/run/docker.sock<span class="w">
</span><span class="w">        </span>target<span class="p">:</span><span class="w"> </span>/var/run/docker.sock<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>type<span class="p">:</span><span class="w"> </span>bind<span class="w">
</span><span class="w">        </span>source<span class="p">:</span><span class="w"> </span>/<span class="w">
</span><span class="w">        </span>target<span class="p">:</span><span class="w"> </span>/rootfs<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>type<span class="p">:</span><span class="w"> </span>bind<span class="w">
</span><span class="w">        </span>source<span class="p">:</span><span class="w"> </span>/etc/localtime<span class="w">
</span><span class="w">        </span>target<span class="p">:</span><span class="w"> </span>/etc/localtime<span class="w">
</span><span class="w">    </span>deploy<span class="p">:</span><span class="w">
</span><span class="w">      </span>mode<span class="p">:</span><span class="w"> </span>global<span class="w">
</span><span class="w">    </span>environment<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>SPM_TOKEN=&lt;YOUR<span class="w"> </span>SPM<span class="w"> </span>TOKEN<span class="sd">&gt;
</span><span class="sd">      - LOGSENE_TOKEN=&lt;YOUR LOGSENE TOKEN&gt;</span></code></pre></td></tr></table>
</div>
</div>
<p>I know that the SPM_TOKEN and LOGSENE_TOKEN shouldn&rsquo;t be in a git repo. I&rsquo;ll address that later, this is for learning/demo purposes only :)</p>

<h2 id="setting-up-your-swarm-stack">Setting up your swarm stack</h2>

<p>In order to deploy your swarm stack you can:</p>

<h3 id="ssh-into-your-swarm-manager-node">ssh into your swarm manager node</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="n">ssh</span> <span class="n">-i</span> <span class="n">c</span><span class="err">:</span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">wessh</span><span class="p">\.</span><span class="n">ssh</span><span class="p">\</span><span class="n">docker_rsa</span> <span class="n">wshaddix</span><span class="p">@&lt;</span><span class="n">mgr</span> <span class="n">public</span> <span class="n">ip</span> <span class="n">address</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="checkout-your-swarm-configuration-repo">Checkout your swarm configuration repo</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="n">git</span> <span class="n">clone</span> <span class="p">&lt;</span><span class="n">your</span> <span class="n">git</span> <span class="n">repo</span> <span class="n">address</span><span class="p">&gt;</span>
<span class="n">cd</span> <span class="p">&lt;</span><span class="n">your</span> <span class="n">repo</span> <span class="n">dir</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="deploy-your-swarm-stack">Deploy your swarm stack</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="n">docker</span> <span class="n">stack</span> <span class="n">deploy</span> <span class="n">-c</span> <span class="n">swarm-services</span><span class="p">.</span><span class="n">yaml</span> <span class="n">monitoring</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="view-metrics-and-logs">View metrics and logs</h2>

<p>This is going to run the Sematext docker agent on each of the host nodes in the cluster. Once they start reporting back to Sematext you can view the results in the Sematext web ui.</p>

<h3 id="metrics">Metrics</h3>

<p><img src="/img/sematext-metrics.png" alt="metrics" /></p>

<h3 id="logs">Logs</h3>

<p><img src="/img/sematext-logs.png" alt="logs" /></p>
    </div>

    
    

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/docker/">docker</a>
          
          <a href="/tags/docker-swarm/">docker-swarm</a>
          
          <a href="/tags/logging/">logging</a>
          
          <a href="/tags/metrics/">metrics</a>
          
          <a href="/tags/sematext/">sematext</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/three-node-docker-swarm-cluster/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Three Node Docker Swarm with Ubuntu 17.04 on Azure</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/team-city-utf-8/">
            <span class="next-text nav-default">Showing UTF8 Characters in TeamCity 10 Build Logs</span>
            <span class="prev-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
    

  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
      Show Disqus Comments
    </div>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
    function load_disqus() {
        
        
        if (window.location.hostname === 'localhost') return;

        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        var disqus_shortname = 'wesshaddix';
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

        $('#load_disqus').remove();
    };
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    

  

  
  </article>
        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:wes.shaddix@outlook.com" rel="me noopener" class="iconfont icon-email"
        title="email" target="_blank">
      </a>
      <a href="https://twitter.com/wshaddix" rel="me noopener" class="iconfont icon-twitter"
        title="twitter" target="_blank">
      </a>
      <a href="https://github.com/wshaddix" rel="me noopener" class="iconfont icon-github"
        title="github" target="_blank">
      </a>
  <a href="http://www.wesshaddix.com/index.xml" rel="noopener" type="application/rss+xml" class="iconfont icon-rss"
    title="rss" target="_blank">
  </a>
</div>

<div class="copyright">
  <span class="copyright-year">
    &copy;
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span><span class="author">Wes Shaddix</span></span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
<script type="text/javascript" src="/dist/jane.min.js?v=2.7.0"></script>





  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  





</body>
</html>
